{% load static %}
<!DOCTYPE html>
<html lang="es" class="h-full bg-gray-50">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="shortcut icon" type="image/png" href="{% static 'custom/img/sisoc_logo.ico' %}" />
        
        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            // Paleta NODO
                            'magenta': '#FF0080',
                            'nodo-purple': '#7928CA',
                            'nodo-cyan': '#08B8CC',
                            // Compatibilidad anterior
                            'primario': '#7928CA',
                            'primario-claro': '#FF0080',
                            'primario-oscuro': '#8908CC',
                            'secundario': '#475569',
                            'secundario-claro': '#64748b',
                            'secundario-oscuro': '#334155',
                            'acento': '#08B8CC',
                            'acento-claro': '#14b8a6',
                            'acento-oscuro': '#0d9488',
                            'arg-azul': '#7928CA',
                            'arg-secundario': '#475569',
                            primary: '#7928CA',
                            secondary: '#475569',
                        },
                        fontFamily: {
                            'lora': ['Lora', 'serif'],
                            'montserrat': ['Montserrat', 'sans-serif'],
                        }
                    }
                }
            }
        </script>
        
        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        
        <!-- Alpine.js for interactivity -->
        <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
        
        <!-- Paleta de colores unificada (DEBE IR PRIMERO) -->
        <link rel="stylesheet" href="{% static 'custom/css/paleta-unificada.css' %}" />
        
        <!-- NODO Brand Manual de Marca -->
        <link rel="stylesheet" href="{% static 'custom/css/nodo-brand.css' %}" />
        
        <!-- Custom CSS Files -->
        <link rel="stylesheet" href="{% static 'custom/css/main.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/custom.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/utils.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/override.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/responsive.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/mobile-modals.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/mobile-forms.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/mobile-tables.css' %}" />
        <link rel="stylesheet" href="{% static 'custom/css/alertas_notifications.css' %}" />
        
        <!-- Page specific CSS -->
        {% block page_css %}{% endblock %}
        
        <!-- Custom styles -->
        {% block head %}{% endblock %}
        
        <title>NODO - {% block title %}{% endblock %}</title>
    </head>
    <body class="min-h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-slate-100 font-montserrat" x-data="{ sidebarOpen: false, sidebarCollapsed: false }" style="background: var(--fondo-principal);">
        <div class="min-h-full">
            {% include 'includes/navbar.html' %}
            {% include 'includes/sidebar/base.html' %}
            
            <div class="transition-all duration-300" :class="sidebarCollapsed ? 'lg:pl-20' : 'lg:pl-72'">
                <main class="py-10">
                    <div class="px-4 sm:px-6 lg:px-8">
                        {% if messages %}
                            {% for message in messages %}
                                <div class="mb-4 rounded-md p-4 {{ message.tags }}" x-data="{ show: true }" x-show="show">
                                    <div class="flex">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-info-circle h-5 w-5"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm font-medium">{{ message }}</p>
                                        </div>
                                        <div class="ml-auto pl-3">
                                            <button @click="show = false" class="inline-flex rounded-md p-1.5 hover:bg-gray-100">
                                                <i class="fas fa-times h-5 w-5"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                        
                        {% block main-content %}
                            <!-- Contenido principal -->
                        {% endblock %}
                    </div>
                </main>
            </div>
        </div>
        
        <!-- Alertas de Eventos Críticos -->
        {% include 'components/alertas_eventos.html' %}
        
        <!-- Chatbot Bubble -->
        {% include 'components/chatbot_bubble.html' %}
        
        <!-- Sistema de Modales Modernos -->
        <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden transition-opacity duration-300">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div id="modal-content" class="bg-white rounded-xl shadow-2xl max-w-md w-full transform transition-all duration-300 scale-95 opacity-0">
                    <!-- Modal Header -->
                    <div id="modal-header" class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div id="modal-icon" class="w-10 h-10 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-info-circle text-xl"></i>
                                </div>
                                <h3 id="modal-title" class="text-lg font-semibold text-gray-900">Información</h3>
                            </div>
                            <button id="modal-close" class="text-gray-400 hover:text-gray-600 transition-colors">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Modal Body -->
                    <div id="modal-body" class="p-6">
                        <p id="modal-message" class="text-gray-600 leading-relaxed"></p>
                    </div>
                    <!-- Modal Footer -->
                    <div id="modal-footer" class="p-6 border-t border-gray-200 flex justify-end space-x-3">
                        <button id="modal-cancel" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors hidden">
                            Cancelar
                        </button>
                        <button id="modal-confirm" class="px-6 py-2 bg-blue-900 text-white rounded-lg hover:bg-blue-800 transition-colors">
                            Aceptar
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CSRF Token para AJAX -->
        {% csrf_token %}
        
        <!-- Mobile Enhancements Script -->
        <script src="{% static 'custom/js/mobile-enhancements.js' %}"></script>
        
        <!-- Sistema de Modales Modernos -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Sistema de Modales Modernos
                window.ModernModal = {
                    show: function(options) {
                        const overlay = document.getElementById('modal-overlay');
                        const content = document.getElementById('modal-content');
                        const icon = document.getElementById('modal-icon');
                        const title = document.getElementById('modal-title');
                        const message = document.getElementById('modal-message');
                        const confirmBtn = document.getElementById('modal-confirm');
                        const cancelBtn = document.getElementById('modal-cancel');
                        const closeBtn = document.getElementById('modal-close');
                        
                        // Configurar tipo de modal
                        const types = {
                            success: { icon: 'fa-check-circle', color: 'bg-green-100 text-green-600', btnColor: 'bg-green-600 hover:bg-green-700' },
                            error: { icon: 'fa-exclamation-triangle', color: 'bg-red-100 text-red-600', btnColor: 'bg-red-600 hover:bg-red-700' },
                            warning: { icon: 'fa-exclamation-triangle', color: 'bg-yellow-100 text-yellow-600', btnColor: 'bg-yellow-600 hover:bg-yellow-700' },
                            info: { icon: 'fa-info-circle', color: 'bg-blue-100 text-blue-600', btnColor: 'bg-blue-900 hover:bg-blue-800' },
                            confirm: { icon: 'fa-question-circle', color: 'bg-purple-100 text-purple-600', btnColor: 'bg-purple-600 hover:bg-purple-700' }
                        };
                        
                        const type = types[options.type] || types.info;
                        
                        // Configurar contenido
                        icon.className = `w-10 h-10 rounded-lg flex items-center justify-center ${type.color}`;
                        icon.querySelector('i').className = `fas ${type.icon} text-xl`;
                        title.textContent = options.title || 'Información';
                        message.textContent = options.message || '';
                        
                        // Configurar botones
                        confirmBtn.textContent = options.confirmText || 'Aceptar';
                        confirmBtn.className = `px-6 py-2 text-white rounded-lg transition-colors ${type.btnColor}`;
                        
                        if (options.type === 'confirm') {
                            cancelBtn.classList.remove('hidden');
                            cancelBtn.textContent = options.cancelText || 'Cancelar';
                        } else {
                            cancelBtn.classList.add('hidden');
                        }
                        
                        // Mostrar modal
                        overlay.classList.remove('hidden');
                        setTimeout(() => {
                            overlay.style.opacity = '1';
                            content.style.transform = 'scale(1)';
                            content.style.opacity = '1';
                        }, 10);
                        
                        // Configurar eventos
                        const closeModal = () => {
                            overlay.style.opacity = '0';
                            content.style.transform = 'scale(0.95)';
                            content.style.opacity = '0';
                            setTimeout(() => {
                                overlay.classList.add('hidden');
                            }, 300);
                        };
                        
                        confirmBtn.onclick = () => {
                            if (options.onConfirm) options.onConfirm();
                            closeModal();
                        };
                        
                        cancelBtn.onclick = () => {
                            if (options.onCancel) options.onCancel();
                            closeModal();
                        };
                        
                        closeBtn.onclick = closeModal;
                        
                        overlay.onclick = (e) => {
                            if (e.target === overlay) closeModal();
                        };
                    }
                };
                
                // Función global para mostrar alertas modernas
                window.showModernAlert = function(type, title, message) {
                    if (typeof ModernModal !== 'undefined') {
                        ModernModal.show({
                            type: type,
                            title: title,
                            message: message
                        });
                    } else {
                        alert(message);
                    }
                };
            });
        </script>
        
        <!-- Alertas WebSocket -->
        {% if user.is_authenticated %}
            <script>
                // Pasar grupos del usuario al JavaScript
                window.userGroups = {{ user_groups_json|safe }};
            </script>
            <script src="{% static 'custom/js/notification_sound.js' %}"></script>
            <script src="{% static 'custom/js/alertas_websocket.js' %}"></script>
            <script src="{% static 'custom/js/alertas_conversaciones_rt.js' %}"></script>
            <script src="{% static 'custom/js/alertas_conversaciones_fallback.js' %}"></script>
            
            <!-- Sistema de tiempo real para conversaciones -->
            {% if 'Conversaciones' in user_groups_list or 'OperadorCharla' in user_groups_list or user.is_superuser %}
                <script src="{% static 'custom/js/conversaciones_tiempo_real_global.js' %}"></script>
                <script src="{% static 'custom/js/conversaciones_lista_ws.js' %}"></script>
            {% endif %}
        {% endif %}
        
        {% block customJS %}{% endblock %}
    </body>
</html>
